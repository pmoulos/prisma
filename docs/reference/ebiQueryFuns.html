<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="These functions can be used to retrieve PRS candidates
    in the format of data frames (compatible with the general
    prisma output as well as the one from 
    aggregatePrsMarkers). This can be done from
    two sources, the EBI PGS Catalog and the EBI GWAS Catalog
    given one or more identifiers. These functions build upon
    the gwasrapidd and quincunx packages which leverage the
    EBI APIs to fetch the required data. An additional 
    feature regarding PGS scores is that while quincunx only
    fetches metadata, getPGSScores actually fetches
    and combines (if possible) the PGS scores, with alleles,
    effects etc. Then, the resulting data frames can be used
    with a GWASExperiment object and either a PRISMA
    external validation pipeline with PRScice2 (takes longer)
    or with vanilla R regression and cross-validation using
    e.g. prsCrossValidate to check their
    performance against one or more traits present in the
    GWASExperiment object."><title>Functions to query EBI GWAS and PGS Catalogs — ebiQueryFuns • prisma</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Functions to query EBI GWAS and PGS Catalogs — ebiQueryFuns"><meta property="og:description" content="These functions can be used to retrieve PRS candidates
    in the format of data frames (compatible with the general
    prisma output as well as the one from 
    aggregatePrsMarkers). This can be done from
    two sources, the EBI PGS Catalog and the EBI GWAS Catalog
    given one or more identifiers. These functions build upon
    the gwasrapidd and quincunx packages which leverage the
    EBI APIs to fetch the required data. An additional 
    feature regarding PGS scores is that while quincunx only
    fetches metadata, getPGSScores actually fetches
    and combines (if possible) the PGS scores, with alleles,
    effects etc. Then, the resulting data frames can be used
    with a GWASExperiment object and either a PRISMA
    external validation pipeline with PRScice2 (takes longer)
    or with vanilla R regression and cross-validation using
    e.g. prsCrossValidate to check their
    performance against one or more traits present in the
    GWASExperiment object."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">prisma</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.3</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/01-introduction.html">Introduction to the prisma package</a>
    <a class="dropdown-item" href="../articles/02-installation.html">PRISMA installation</a>
    <a class="dropdown-item" href="../articles/03-gwasexperiment.html">The GWASExperiment class</a>
    <a class="dropdown-item" href="../articles/04-inoutfilter.html">Reading, writing and filtering files and objects</a>
    <a class="dropdown-item" href="../articles/05-imputemerge.html">Imputation of missing genotypes, genotype extension and dataset merging</a>
    <a class="dropdown-item" href="../articles/06-gwasfuns.html">Single trait association tests and summary statistics</a>
    <a class="dropdown-item" href="../articles/07-prsfuns.html">Derivation of PRS candidates and evaluation</a>
    <a class="dropdown-item" href="../articles/08-pipelines.html">Complete PRISMA pipelines</a>
    <a class="dropdown-item" href="../articles/09-external.html">Evaluation of external PRS or external GWAS</a>
  </div>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/pmoulos/prisma/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Functions to query EBI GWAS and PGS Catalogs</h1>
      
      <div class="d-none name"><code>ebiQueryFuns.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>These functions can be used to retrieve PRS candidates
    in the format of data frames (compatible with the general
    <code><a href="prismaFuns.html">prisma</a></code> output as well as the one from 
    <code><a href="aggregatePrsMarkers.html">aggregatePrsMarkers</a></code>). This can be done from
    two sources, the EBI PGS Catalog and the EBI GWAS Catalog
    given one or more identifiers. These functions build upon
    the gwasrapidd and quincunx packages which leverage the
    EBI APIs to fetch the required data. An additional 
    feature regarding PGS scores is that while quincunx only
    fetches metadata, <code>getPGSScores</code> actually fetches
    and combines (if possible) the PGS scores, with alleles,
    effects etc. Then, the resulting data frames can be used
    with a <code>GWASExperiment</code> object and either a PRISMA
    external validation pipeline with PRScice2 (takes longer)
    or with vanilla R regression and cross-validation using
    e.g. <code><a href="prismaCvFuns.html">prsCrossValidate</a></code> to check their
    performance against one or more traits present in the
    <code>GWASExperiment</code> object.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="fu">getGWASVariants</span><span class="op">(</span>efoId <span class="op">=</span> <span class="cn">NULL</span>, efoTrait <span class="op">=</span> <span class="cn">NULL</span>, 
        removeUnknownRisk <span class="op">=</span> <span class="cn">TRUE</span>, retries <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>
    
    <span class="fu">getPGSScores</span><span class="op">(</span>pgsId <span class="op">=</span> <span class="cn">NULL</span>, efoId <span class="op">=</span> <span class="cn">NULL</span>, pubmedId <span class="op">=</span> <span class="cn">NULL</span>,
        base <span class="op">=</span> <span class="cn">NULL</span>, retries <span class="op">=</span> <span class="fl">5</span>, validateLoc <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
    
    <span class="fu">prismaLookup</span><span class="op">(</span><span class="va">prismaOut</span><span class="op">)</span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>efoId</dt>
<dd><p>One or more EFO ids in proper format. See
    also Details.</p></dd>
<dt>efoTrait</dt>
<dd><p>One or more EFO traits in free text 
    format, which should be existing. See also Details.</p></dd>
<dt>pgsId</dt>
<dd><p>One or more PGS ids in proper format. See
    also Details.</p></dd>
<dt>pubmedId</dt>
<dd><p>One or more PubMed ids in proper format.</p></dd>
<dt>retries</dt>
<dd><p>The number of retries in case of API call
    failures.</p></dd>
<dt>removeUnknownRisk</dt>
<dd><p>Should variants of unknown risk
    be removed in a score from GWAS Catalog? Defaults to
    <code>TRUE</code>.</p></dd>
<dt>base</dt>
<dd><p>The base path for the PGS Catalog location.
    It can be a local path, see also Details.</p></dd>
<dt>validateLoc</dt>
<dd><p>Validate SNP locations in retrieved
    PGS scores? Defaults to <code>FALSE</code>, see also Details.</p></dd>
<dt>prismaOut</dt>
<dd><p>An output object from <code><a href="prismaFuns.html">prisma</a></code>
    or a list of PRS candidate data frames.</p></dd>
</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A data frame such as the one from 
<code><a href="aggregatePrsMarkers.html">aggregatePrsMarkers</a></code> when used with a
<code>GWASExperiment</code> object as accompanying input,
    with as many values filled as possible (e.g. GWAS
    Catalog does not record variant regression effects.)
    For <code>prismaLookup</code>, a list of lists. The outer
    level is named with the GWA methods in <code>prismaOut</code>.
    The inner level is named according to the PRS candidate
    names for each GWA method in <code>prismaOut</code>.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Regarding the <code>efoId</code> argument, this has to be one
    or more valid EFO ids from the GWAS Catalog in proper
    format (e.g. <code>"EFO_0004566"</code>). Improper format is 
    detected and rejected by the respective function. The 
    same applies to the <code>pgsId</code> argument which should be 
    like <code>"PGS000034"</code> and the <code>pubmedId</code> format 
    which should be like <code>"32527150"</code>.</p>    
<p>Regarding the <code>base</code> argument, this can be either
    <code>NULL</code> (the default) to retrieve the PGS score from
    the link present in the quincunx API call metadata, or
    a local path following the same structure as the PGS
    catalog FTP storage. The first case is more guaranteed
    but prone to connection errors, depending also on the
    operation system, and especially when multiple score
    files must be retrieved and processed. The second case
    assumes that the scores of the PGS Catalog are stored
    somewhere locally (they do not occupy much space).
    This can be done for example with Linux <code>wget</code>
    command:</p>    
<p></p><div class="sourceCode"><pre><code>
        mkdir -p LOCAL_PATH
        cd LOCAL_PATH
        wget -m ftp://anonymous:@ftp.ebi.ac.uk/pub/databases/spot/pgs/scores/
        
        # Then in R:
        # base &lt;- LOCAL_PATH/ftp.ebi.ac.uk/pub/databases/spot/pgs/scores/
        # If the long path is not desired:
        
        cd LOCAL_PATH/ftp.ebi.ac.uk/pub/databases/spot/pgs/scores/
        mv * ../../../../../../
        cd LOCAL_PATH
        rm -r ./ftp.ebi.ac.uk/pub/databases/spot/pgs/scores/
        
        # Then in R: base &lt;- LOCAL_PATH
    </code></pre></div>
    
<p>Regarding the <code>validateLoc</code> argument, in case of 
    duplicates remaining after basic position/id/risk allele 
    deduplication, when <code>TRUE</code>, performs location 
    validation, as in some cases, duplicate rs ids have 
    different locations (especially when the genome assembly 
    is not reported (<code>"nr"</code>) and potentially indicating 
    very old genome assemblies (&lt;hg18). The process relies on 
    the package biomaRt and uses it to query the duplicate rs 
    ids and cross-validate the locations retrieved from 
    Ensembl variation databases. SNPs with locations that 
    cannot be validated are dropped and deduplicated. As the 
    process involves calling Ensembl APIs, it ma be slow. 
    Therefore, if the intended use of the retrieved PRS is 
    to plugin the SNPs to other GWAS data, <code>validateLoc</code> 
    can be <code>FALSE</code> to speed up the process and reduce 
    failures, as the unique SNP ids are used with local 
    genotypes instead of location. In other cases where 
    strict validation is required (e.g. when ORs must be 
    used or reported, then it should be <code>TRUE</code>.</p>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Panagiotis Moulos</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span class="co"># \donttest{</span></span>
<span class="r-in">    <span class="co"># Assume an internet connection!</span></span>
<span class="r-in">    <span class="va">efoId</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"EFO_0004566"</span>,<span class="st">"EFO_0005937"</span><span class="op">)</span></span>
<span class="r-in">    <span class="va">efoTrait</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"body weight gain"</span>,</span>
<span class="r-in">        <span class="st">"longitudinal BMI measurement"</span><span class="op">)</span> </span>
<span class="r-in">    </span>
<span class="r-in">    <span class="va">test1</span> <span class="op">&lt;-</span> <span class="fu">getGWASVariants</span><span class="op">(</span>efoId<span class="op">=</span><span class="va">efoId</span>,</span>
<span class="r-in">        removeUnknownRisk<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Scheduling 2 GWAS API calls...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   Requesting 2 GWAS API calls with  EFO ID(s)...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     Call 1: EFO_0004566</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     Call 2: EFO_0005937</span>
<span class="r-in">    <span class="va">test2</span> <span class="op">&lt;-</span> <span class="fu">getGWASVariants</span><span class="op">(</span>efoTrait<span class="op">=</span><span class="va">efoTrait</span><span class="op">)</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Scheduling 2 GWAS API calls...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   Requesting 2 GWAS API calls with EFO trait(s)...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     Call 1: body weight gain</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     Call 2: longitudinal BMI measurement</span>
<span class="r-in">    </span>
<span class="r-in">    <span class="va">pgsId</span> <span class="op">&lt;-</span> <span class="st">"PGS000034"</span></span>
<span class="r-in">    <span class="va">test3</span> <span class="op">&lt;-</span> <span class="fu">getPGSScores</span><span class="op">(</span>pgsId<span class="op">=</span><span class="va">pgsId</span><span class="op">)</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Scheduling 1 PGS API calls...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   Requesting 1 PGS Catalog API calls with PGS ID(s)...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     Call 1: PGS000034</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Retrieving and enriching scores file(s) for PGS000034</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   remote file PGS000034.txt.gz</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   processing PGS000034</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Dealing with duplicates (if any)</span>
<span class="r-in">    </span>
<span class="r-in">    <span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">prisma_out</span>,package<span class="op">=</span><span class="st">"prisma"</span><span class="op">)</span></span>
<span class="r-in">    <span class="va">lookup</span> <span class="op">&lt;-</span> <span class="fu">prismaLookup</span><span class="op">(</span><span class="va">prismaOut</span><span class="op">)</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> -----&gt; Querying for glm</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Querying GWAS Catalog with the largest PRS</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   Querying association 62070264</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> -----&gt; Querying for statgen</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Querying GWAS Catalog with the largest PRS</span>
<span class="r-in"><span class="co"># }</span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Panagiotis Moulos.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.3.9000.</p>
</div>

    </footer></div>

  

  

  </body></html>

